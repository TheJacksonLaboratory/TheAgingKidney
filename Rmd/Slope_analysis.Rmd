---
title: "Direction of Change with Age"
author: "Yuka Takemon"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

For each gene that we have both mRNA and protein expression data, we fitted a linear model
$$ y_{i} \sim Age + Sex + Generation $$
and then tested the significance of the effects Age and recorded its p-values and slope. For the 6667 genes for which we have both mRNA and protein expression data, we can illustrate the distinct changes in expression with age and identify those that are significant.

In our manuscript we analysed the significant quadrants, coloured in purple below, using the Ingenuity Pathway Analyais (IPA) to identify enriched biological pathways. To see our findings please refer to our manuscript. 

<span style="color:red">Link to Rmd page</span>
\  
\      
```{r setup, echo=FALSE, message=FALSE}
# Set directory
setwd("~/Dropbox/TheAgingKidneyData")

# Load library and data
library(tidyverse)
load("./RData/DO188b_kidney_noprobs.RData")
data <- read_csv("./ANOVA/kidney_anova_slope_output.csv")
```

```{r plotting, echo = FALSE, message=FALSE, fig.height = 7, fig.width= 7, fig.align = "center"}
# For only slopes and sigcols
mcols <- grep("^m.", colnames(data))
sigcols <- grep("^p.", colnames(data))
data <- data[, c(1:8, mcols, sigcols)]

# Age (not interacting with sex)------------------------------------------------
# Using only age realated mRNA and Protein that are significant < 0.05
df_age <- data[data$p.mRNA_Age.Sex <= 0.05,]
df_age <- df_age[df_age$p.Prot_Age.Sex <= 0.05,]
# N = 693

# Count number of genes in each quadrant
# mRNA-Protein
total <- nrow(df_age)
quadI <- nrow(df_age[((df_age$m.mRNA_Age.Sex > 0) & (df_age$m.Prot_Age.Sex > 0)),])
quadIV <- nrow(df_age[((df_age$m.mRNA_Age.Sex > 0) & (df_age$m.Prot_Age.Sex < 0)),])
quadII <- nrow(df_age[((df_age$m.mRNA_Age.Sex < 0) & (df_age$m.Prot_Age.Sex > 0)),])
quadIII <- nrow(df_age[((df_age$m.mRNA_Age.Sex < 0) & (df_age$m.Prot_Age.Sex < 0)),])

# Plot age realted mRNA/Protein slopes
ggplot() +
      geom_point(data = data, aes(x = m.mRNA_Age.Sex, y = m.Prot_Age.Sex), colour =  "#64676d", alpha = 0.3) +
      geom_point(data = df_age, aes(x = m.mRNA_Age.Sex, y = m.Prot_Age.Sex), colour = "#66125c") +
      scale_x_continuous("mRNA-Age.Sex",
                         breaks = seq(-1, 1, by = 0.1)) +
      scale_y_continuous("Protein-Age.Sex",
                         breaks = seq(-1, 1, by = 0.1)) +
      geom_vline(xintercept = 0) +
      geom_hline(yintercept = 0) +
      labs( title = "Direction of change in gene expression with Age",
            subtitle = paste0("Slope: RNA v. Protein, Total = ", total, ", Sig = ", nrow(df_age))) +
      annotate("text", x = 0.25, y = 0.85, label = paste("A = ", quadI)) +
      annotate("text", x = 0.25, y = -0.85, label = paste("C = ", quadIV)) +
      annotate("text", x = -0.25, y = 0.85, label = paste("D = ", quadII)) +
      annotate("text", x = -0.25, y = -0.85, label = paste("B = ", quadIII)) +
      theme(panel.background = element_blank(),
            panel.border = element_rect( colour = "black", fill = NA))
```

<span style="color:red">Link to output file that'll need to be incorporated</span>


### Session Information

```{r session-info}
sessionInfo()
```
